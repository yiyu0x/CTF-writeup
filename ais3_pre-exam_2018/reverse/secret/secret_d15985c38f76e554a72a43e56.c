/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 (**init_proc())(void);
void sub_6A0();
// int puts(const char *s);
// int fputc(int c, FILE *stream);
// void srand(unsigned int seed);
// FILE *fopen(const char *filename, const char *modes);
// __int64 __fastcall __isoc99_scanf(_QWORD, _QWORD); weak
// int rand(void);
// __int64 __fastcall _cxa_finalize(_QWORD); weak
int *deregister_tm_clones();
__int64 register_tm_clones();
int *_do_global_dtors_aux();
__int64 frame_dummy();
void init();
int __cdecl main(int argc, const char **argv, const char **envp);
void __fastcall _libc_csu_init(unsigned int a1, __int64 a2, __int64 a3);
void term_proc();
// __int64 ITM_deregisterTMCloneTable(void); weak
// __int64 _gmon_start__(void); weak

//-------------------------------------------------------------------------
// Data declarations

int dword_0 = 1179403647; // weak
__int64 (__fastcall *_frame_dummy_init_array_entry)() = &frame_dummy; // weak
__int64 (__fastcall *_do_global_dtors_aux_fini_array_entry)() = &_do_global_dtors_aux; // weak
void *_dso_handle = &_dso_handle; // weak
_DWORD secret[85] =
{
  12591,
  3591,
  5055,
  7103,
  9599,
  1143,
  1247,
  8567,
  14583,
  1951,
  14583,
  383,
  9271,
  14735,
  14623,
  1335,
  11567,
  12727,
  6975,
  10999,
  7247,
  6511,
  14559,
  3591,
  4167,
  12055,
  5551,
  7967,
  14215,
  3951,
  5631,
  5591,
  7975,
  4375,
  6879,
  12247,
  7111,
  7495,
  15191,
  5607,
  3151,
  13399,
  943,
  14239,
  7959,
  9295,
  10639,
  3735,
  1951,
  31,
  7911,
  8751,
  1503,
  7751,
  12663,
  6383,
  13823,
  13039,
  13751,
  5143,
  135,
  3519,
  11255,
  7599,
  2239,
  11583,
  13807,
  9871,
  13519,
  12511,
  9439,
  11343,
  6151,
  11199,
  10103,
  12911,
  14727,
  13743,
  11047,
  15895,
  9143,
  12767,
  8831,
  11103,
  3855
}; // idb
char _bss_start; // weak
int cnt; // weak
// extern _UNKNOWN __cxa_finalize; weak


//----- (0000000000000680) ----------------------------------------------------
__int64 (**init_proc())(void)
{
  __int64 (**result)(void); // rax

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    result = (__int64 (**)(void))_gmon_start__();
  return result;
}
// 2011D8: using guessed type __int64 _gmon_start__(void);

//----- (00000000000006A0) ----------------------------------------------------
void sub_6A0()
{
  JUMPOUT(&dword_0);
}
// 0: using guessed type int dword_0;

//----- (0000000000000730) ----------------------------------------------------
#error "736: positive sp value has been found (funcsize=3)"

//----- (0000000000000760) ----------------------------------------------------
int *deregister_tm_clones()
{
  int *result; // rax

  result = &cnt;
  if ( &cnt != &cnt )
  {
    result = (int *)&ITM_deregisterTMCloneTable;
    if ( &ITM_deregisterTMCloneTable )
      result = (int *)ITM_deregisterTMCloneTable();
  }
  return result;
}
// 201178: using guessed type int cnt;
// 2011D0: using guessed type __int64 ITM_deregisterTMCloneTable(void);

//----- (00000000000007A0) ----------------------------------------------------
__int64 register_tm_clones()
{
  return 0LL;
}

//----- (00000000000007F0) ----------------------------------------------------
int *_do_global_dtors_aux()
{
  int *result; // rax

  if ( !_bss_start )
  {
    if ( &__cxa_finalize )
      _cxa_finalize(_dso_handle);
    result = deregister_tm_clones();
    _bss_start = 1;
  }
  return result;
}
// 720: using guessed type __int64 __fastcall _cxa_finalize(_QWORD);
// 201008: using guessed type void *_dso_handle;
// 201174: using guessed type char _bss_start;

//----- (0000000000000830) ----------------------------------------------------
__int64 frame_dummy()
{
  return register_tm_clones();
}

//----- (000000000000083A) ----------------------------------------------------
void init()
{
  signed int i; // [rsp+Ch] [rbp-4h]

  srand(0);
  for ( i = 0; i <= 84; ++i )
  {
    secret[i] += 5;
    secret[i] >>= 1;
    secret[i] -= 10;
    secret[i] >>= 2;
  }
}

//----- (0000000000000930) ----------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v4; // [rsp+4h] [rbp-1Ch]
  int i; // [rsp+8h] [rbp-18h]
  int v6; // [rsp+Ch] [rbp-14h]
  FILE *stream; // [rsp+10h] [rbp-10h]
  unsigned __int64 v8; // [rsp+18h] [rbp-8h]

  v8 = __readfsqword(0x28u);
  stream = fopen("/tmp/secret", "w");
  init();
  puts("========== WELCOME TO MY MIND ==========");
  puts("Try to find out secret in my mind!!!");
  while ( cnt != 85 )
  {
    __isoc99_scanf("%d", &v4);
    v6 = rand() % 2018;
    if ( v6 != v4 )
    {
      puts("Get out!!! You don't know me.");
      return 0;
    }
    secret[cnt] ^= v4;
    puts("Nice try! Next one.");
    ++cnt;
  }
  for ( i = 0; i <= 84; ++i )
    fputc((unsigned __int8)secret[i], stream);
  puts("You know the flag~~~");
  return 0;
}
// 700: using guessed type __int64 __fastcall __isoc99_scanf(_QWORD, _QWORD);
// 201178: using guessed type int cnt;

//----- (0000000000000AB0) ----------------------------------------------------
void __fastcall _libc_csu_init(unsigned int a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r13
  signed __int64 v4; // rbp
  __int64 v5; // rbx

  v3 = a3;
  v4 = &_do_global_dtors_aux_fini_array_entry - &_frame_dummy_init_array_entry;
  init_proc();
  if ( v4 )
  {
    v5 = 0LL;
    do
      ((void (__fastcall *)(_QWORD, __int64, __int64))*(&_frame_dummy_init_array_entry + v5++))(a1, a2, v3);
    while ( v4 != v5 );
  }
}
// 200D88: using guessed type __int64 (__fastcall *_frame_dummy_init_array_entry)();
// 200D90: using guessed type __int64 (__fastcall *_do_global_dtors_aux_fini_array_entry)();

//----- (0000000000000B24) ----------------------------------------------------
void term_proc()
{
  ;
}

#error "There were 1 decompilation failure(s) on 11 function(s)"
